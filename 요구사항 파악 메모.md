# 쿠폰 시스템의 워크플로우
1. 쿠폰 정보 생성 (관리자) : couponInfo, couponCondition 생성
   - 관리자가 CouponInfo를 생성하고 조건(CouponCondition)을 설정
   - 이 단계에서 쿠폰의 기본 정보, 발행 수량(pressCount), 발행 유형(UNI/POLY) 등이 결정
2. 쿠폰 코드 생성 (관리자) : couponBook 생성
    - CouponPublishType이 UNI면 동일한 코드가, POLY면 난수로 생성된 고유한 코드가 생성
    - CouponInfo.pressCount만큼 쿠폰코드(그리고 CouponBook) 가 생성 
      - UNI: 1개 코드, 추후 사용시 pressCount 개수만큼
      - POLY: pressCount 개수만큼 코드 생성
    - 이 시점에서는 아직 누구에게도 발급되지 않은 상태 CouponBook (isUsed = false)
3. 쿠폰 발급 (관리자) : personalCoupon 생성, couponBook 업데이트, couponLog 생성
   - CouponBook에서 미사용 쿠폰 코드를 가져와 특정 사용자(Person)에게 할당
   - PersonalCoupon(personId, couponCode) 생성, 저장
   - 쿠폰 로그(CouponLog)에도 발급 기록(PUBLISH)
4. 쿠폰 사용 (사용자) : personalCoupon 업데이트, couponBook 업데이트, couponLog 생성
   - PersonalCoupon 업데이트 (isUsed = true, insuranceSubscriptionDetailsId, useData)
   - CouponBook 업데이트 (isUsed = true)
   - CouponLog 에 사용 기록

# 쿠폰 발급 흐름:
CouponInfo 생성(관리자) →
CouponCondition 설정(관리자) →
CouponBook 생성(시스템) →
PersonalCoupon 발급(사용자)

# 시스템 흐름 단계별 CouponInfo 주요 속성 (단계별 필요 객체 생성 및 검증에 관여)
## CouponBook 생성시 : 
  - couponPublishType: UNI/POLY
  - pressCount: 발행 수량
  - isAble : 쿠폰 전체 중지 제어
## PersonalCoupon 발급시 : 
  - couponPublishType: UNI/POLY
    - UNI: couponCode : personId = 1 : **N** (발급수 제한은 pressCount 로)
    - POLY: couponCode : personId = 1 : 1 (발급수 제한은 couponBook 의 isUsed = false 인 객체수로)
  - pressCount
    - 위에 쓰인대로
  - isAble : 쿠폰 전체 중지 제어
  - couponEndAt (= couponBook의 expireAt) 이전이면 발급 가능
  - isDuplicate - 동일 사용자 중복 사용 가능 여부 

  * 정리 
    isDuplicate: 발급에 관한 제한 (사용자당 같은 쿠폰을 몇 번 발급받을 수 있는가?)
    couponType: 사용에 관한 제한 (발급받은 하나의 쿠폰을 몇 번 사용할 수 있는가? -> 쿠폰북 발급과 상관없음)
## CouponBook 사용시 : (더 정리필요)
  - CouponType - 쿠폰 사용 유형
    - ONCE: 1회
    - MULTI: 다회
    - LIMIT: 제한
  - couponPublishType: UNI/POLY
  - limitCount
  - pressCount
    - couponPublishType 이 UNI 일 경우 : 총 사용량 pressCount 까지?
    - couponPublishType 이 POLY 일 경우 :
  - isDuplicate - 중복 사용 가능 여부 -> couponType 이랑 겹치는 거 아닌가..
  - isAble : 쿠폰 전체 중지 제어
  - couponStartAt, couponEndAt 사이에 사용 가능